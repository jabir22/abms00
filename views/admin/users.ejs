<%- include('../partials/header') %>

<!-- =============== LAYOUT =============== -->
<%- include('../partials/sidebar') %>

<main class="main-content users-page">
  
  <!-- Page Header -->
  <header class="content-header">
    <h1><i class="fas fa-users"></i> ইউজার ব্যবস্থাপনা</h1>
    <button class="btn btn-primary" onclick="openModal('create')">
      <i class="fas fa-plus"></i> নতুন ইউজার
    </button>
  </header>

  <!-- Users Table Card -->
  <section class="card">
    <div class="card-body">
      <div class="table-responsive">
        <table id="usersTable" class="display">
          <thead>
            <tr>
              <th>নাম</th>
              <th>ইমেইল</th>
              <th>ফোন</th>
              <th>পদবী</th>
              <th>স্ট্যাটাস</th>
              <th>অ্যাকশন</th>
            </tr>
          </thead>
          <tbody>
            <!-- DataTable will populate this -->
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Create/Edit User Modal -->
  <div id="userModal" class="modal">
    <div class="modal-content">
      <header class="modal-header">
        <h2 id="modalTitle"></h2>
        <button class="close-btn" onclick="closeModal()"><i class="fas fa-times"></i></button>
      </header>
      <div class="modal-body">
        <form id="userForm">
          <input type="hidden" id="userId">

          <div class="form-group">
            <label for="name">নাম (ইংরেজি) <span class="required">*</span></label>
              <input type="text" id="name" name="name" placeholder="যেমনঃ Jabir (আবশ্যক)" required aria-required="true">
            <small class="form-hint">ব্যবহারকারীর পূর্ণ নাম ইংরেজিতে প্রবেশ করুন</small>
          </div>

          <div class="form-group">
            <label for="name_bn">নাম (বাংলা)</label>
            <input type="text" id="name_bn" name="name_bn" placeholder="যেমনঃ জাবির">
            <small class="form-hint">বাংলায় ব্যবহারকারীর নাম (ঐচ্ছিক)</small>
          </div>

          <div class="form-group">
            <label for="email">ইমেইল <span class="required">*</span></label>
              <input type="email" id="email" name="email" placeholder="যেমনঃ jabir@jabir.com (আবশ্যক)" required aria-required="true">
            <small class="form-hint">বৈধ ইমেইল ঠিকানা প্রবেশ করুন</small>
          </div>

          <div class="form-group">
            <label for="phone">মোবাইল নম্বর</label>
            <input type="tel" id="phone" name="phone" placeholder="যেমনঃ 01800000000" pattern="[0-9]{11}" maxlength="11">
            <small class="form-hint">১১ অঙ্কের বাংলাদেশী মোবাইল নম্বর</small>
          </div>

          <div class="form-group">
            <label for="role">পদবী <span class="required">*</span></label>
              <select id="role" name="role_id" required aria-required="true">
              <option value="">পদবী নির্বাচন করুন...</option>
              <!-- Roles will be populated dynamically -->
            </select>
            <small class="form-hint">ব্যবহারকারীকে একটি ভূমিকা নির্ধারণ করুন</small>
          </div>

          <div class="form-group password-group">
            <label for="password">পাসওয়ার্ড <span class="required password-required">*</span></label>
            <div class="password-input">
                <input type="password" id="password" name="password" placeholder="শক্তিশালী পাসওয়ার্ড প্রবেশ করুন (আবশ্যক)">
              <button type="button" class="toggle-password" onclick="togglePassword()" title="পাসওয়ার্ড দেখান/লুকান">
                <i class="fas fa-eye"></i>
              </button>
            </div>
            <small class="password-hint">ন্যূনতম ৮ অক্ষর, সংখ্যা এবং বিশেষ অক্ষর সহ। নতুন ইউজার তৈরির সময় বাধ্যতামূলক।</small>
          </div>
        </form>
      </div>
      <footer class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeModal()">বাতিল</button>
        <button type="button" class="btn btn-primary" onclick="saveUser()">সংরক্ষণ করুন</button>
      </footer>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <header class="modal-header">
        <h2>ইউজার মুছে ফেলুন</h2>
        <button class="close-btn" onclick="closeDeleteModal()"><i class="fas fa-times"></i></button>
      </header>
      <div class="modal-body">
        <p>আপনি কি নিশ্চিত যে এই ইউজার মুছে ফেলতে চান?</p>
        <input type="hidden" id="deleteUserId">
      </div>
      <footer class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeDeleteModal()">না</button>
        <button type="button" class="btn btn-danger" onclick="confirmDelete()">হ্যাঁ, মুছে ফেলুন</button>
      </footer>
    </div>
  </div>

  <!-- Assign Role Modal -->
  <div id="assignRoleModal" class="modal">
    <div class="modal-content">
      <header class="modal-header">
        <h2>পদবী বরাদ্দ করুন</h2>
        <button class="close-btn" onclick="closeAssignRoleModal()"><i class="fas fa-times"></i></button>
      </header>
      <div class="modal-body">
        <input type="hidden" id="assignUserId">
        <div class="form-row">
          <div class="form-group" style="flex:1;margin-right:8px;">
            <label>From (বর্তমান পদবী)</label>
            <div id="assignRoleFrom" class="readonly-field">-</div>
          </div>
          <div class="form-group" style="flex:1;margin-left:8px;">
            <label>To (নতুন পদবী)</label>
            <select id="assignRoleTo">
              <option value="">পদবী নির্বাচন করুন</option>
            </select>
          </div>
        </div>
      </div>
      <footer class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeAssignRoleModal()">বাতিল</button>
        <button type="button" class="btn btn-primary" onclick="confirmAssignRole()">বরাদ্দ করুন</button>
      </footer>
    </div>
  </div>
</main>

<%- include('../partials/footer') %>
